name: Run Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        test-dir: ['tests/one_file', 'tests/simple_demo']
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y g++-14
    
    - name: Run ${{ matrix.test-dir }} tests
      run: |
        echo "CC=gcc-14" >> $GITHUB_ENV
        echo "CXX=g++-14" >> $GITHUB_ENV
        echo "export CC CXX" >> $GITHUB_ENV
        cd ${{ matrix.test-dir }}
        bash test.sh
